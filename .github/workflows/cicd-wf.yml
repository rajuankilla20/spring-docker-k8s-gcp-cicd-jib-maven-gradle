name: Spring-Docker Release workflow
on:
  pull_request:
    branches: master
  
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v1
      with:
        ref: master
    - name: Set Cluster credentials
      run: |
        echo ::set-env name=CLUSTER_NAME::${{ secrets.G_CLUSTER_NAME }}
        echo ::set-env name=CLUSTER_ZONE::${{ secrets.G_ZONE_NAME }}
        echo ::set-env name=PROJECT_NAME::${{ secrets.G_PROJECT_ID }}
        echo ::set-env name=APP_CREDENTIALS::${{ secrets.G_APPLICATION_CREDENTIALS }}
        
## It will generate by default, which is similar to Container entrypoint set to [java, -cp, /app/resources:/app/classes:/app/libs/*, com.rankilla20.springdocker.SpringDockerApplication]      
    - name: kubectl - Google Cloud GKE cluster.
      # You may pin to the exact commit or the version.
      # uses: ameydev/gke-kubectl-action@dbe114f1703050edcbdc4285cab3f859646834d2
      uses: ameydev/gke-kubectl-action@v1.02
      with:
        # GCP authorization credentials
        APPLICATION_CREDENTIALS: ${{ env.APP_CREDENTIALS }}
        # Project id
        PROJECT_ID: ${{ env.PROJECT_NAME }}
        # GKE Cluser Name
        CLUSTER_NAME: ${{ env.CLUSTER_NAME }}
        # Zone Name
        ZONE_NAME: ${{ env.CLUSTER_ZONE }}
    - name: List directories
      run: ls -ltr
